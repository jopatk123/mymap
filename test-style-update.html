<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点位样式更新测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🎨 点位样式更新测试</h1>
    
    <div class="test-section">
        <h3>测试步骤</h3>
        <ol>
            <li>打开浏览器开发者工具</li>
            <li>访问地图页面：<a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
            <li>点击右上角的"点位图标"按钮</li>
            <li>修改视频点位或全景图点位的样式</li>
            <li>点击"保存配置"</li>
            <li>观察地图上的点位是否立即更新样式</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>预期结果</h3>
        <ul>
            <li>✅ 点击保存后，地图上的点位样式应该立即更新</li>
            <li>✅ 不需要手动刷新页面</li>
            <li>✅ 控制台不应该有错误信息</li>
            <li>✅ 样式配置应该正确保存到服务器</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>测试API</h3>
        <button onclick="testVideoStyleAPI()">测试视频点位样式API</button>
        <button onclick="testPanoramaStyleAPI()">测试全景图点位样式API</button>
        <div id="api-result"></div>
    </div>

    <div class="test-section">
        <h3>故障排除</h3>
        <p>如果遇到问题，请检查：</p>
        <ul>
            <li>后端服务器是否正常运行（http://localhost:3002）</li>
            <li>前端开发服务器是否正常运行（http://localhost:3000）</li>
            <li>浏览器控制台是否有JavaScript错误</li>
            <li>网络请求是否成功（检查Network标签）</li>
        </ul>
    </div>

    <script>
        const API_BASE = 'http://localhost:3002/api';

        function displayResult(result, isError = false) {
            const element = document.getElementById('api-result');
            element.innerHTML = `<pre class="${isError ? 'error' : 'success'}">${JSON.stringify(result, null, 2)}</pre>`;
        }

        async function testVideoStyleAPI() {
            try {
                // 测试获取当前样式
                const getResponse = await fetch(`${API_BASE}/point-styles/video`);
                const currentStyles = await getResponse.json();
                
                // 测试更新样式
                const testStyles = {
                    point_color: '#ff0000',
                    point_size: 12,
                    point_opacity: 0.8,
                    point_label_size: 16,
                    point_label_color: '#ffffff'
                };
                
                const updateResponse = await fetch(`${API_BASE}/point-styles/video`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testStyles)
                });
                
                const updateResult = await updateResponse.json();
                
                displayResult({
                    message: '视频点位样式API测试成功',
                    currentStyles: currentStyles.data,
                    updatedStyles: updateResult.data
                });
                
            } catch (error) {
                displayResult({ error: error.message }, true);
            }
        }

        async function testPanoramaStyleAPI() {
            try {
                // 测试获取当前样式
                const getResponse = await fetch(`${API_BASE}/point-styles/panorama`);
                const currentStyles = await getResponse.json();
                
                // 测试更新样式
                const testStyles = {
                    point_color: '#00ff00',
                    point_size: 10,
                    point_opacity: 0.9,
                    point_label_size: 14,
                    point_label_color: '#000000'
                };
                
                const updateResponse = await fetch(`${API_BASE}/point-styles/panorama`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testStyles)
                });
                
                const updateResult = await updateResponse.json();
                
                displayResult({
                    message: '全景图点位样式API测试成功',
                    currentStyles: currentStyles.data,
                    updatedStyles: updateResult.data
                });
                
            } catch (error) {
                displayResult({ error: error.message }, true);
            }
        }
    </script>
</body>
</html>